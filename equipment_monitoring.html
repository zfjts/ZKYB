<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生命周期分析</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="/static/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0f172a',
                        secondary: '#1e40af',
                        accent: '#3b82f6',
                        neon: '#06b6d4',
                        dark: '#020617',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .bg-gradient-tech {
                background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            }
            .text-shadow-neon {
                text-shadow: 0 0 8px rgba(6, 182, 212, 0.5);
            }
            .border-glow {
                box-shadow: 0 0 5px rgba(6, 182, 212, 0.7);
            }
            .align-middle {
                vertical-align: middle;
            }
        }
    </style>
</head>
<body class="bg-dark text-gray-100 min-h-screen font-sans">
    <header class="bg-primary border-b border-neon/30 shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <h1 class="text-3xl font-bold text-center">自控设备全生命周期管理平台</h1>
        </div>
    </header>

    <nav class="bg-primary/80 backdrop-blur-md shadow-md border-b border-neon/20">
        <div class="container mx-auto px-4">
            <ul class="flex space-x-6 py-4">
                <li><a href="/" class="font-medium text-gray-300 hover:text-neon transition-colors duration-300">首页</a></li>
                <li><a href="/equipment/" class="font-medium text-gray-300 hover:text-neon transition-colors duration-300">设备管理</a></li>
                <li><a href="/monitoring/" class="font-medium text-neon border-b-2 border-neon pb-1 transition-colors duration-300">生命周期分析</a></li>
            </ul>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-semibold text-shadow-neon">生命周期分析</h2>
        </div>

        <!-- 图表区域 -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
            <div class="bg-primary rounded-xl p-6 shadow-lg border border-neon/20">
                <h3 class="text-xl font-semibold mb-6 text-white">设备寿命状态</h3>
                <div class="h-80">
                    <canvas id="equipmentLifespanChart"></canvas>
                </div>
            </div>
            <div class="bg-primary rounded-xl p-6 shadow-lg border border-neon/20">
                <h3 class="text-xl font-semibold mb-6 text-white">维护周期分析</h3>
                <div class="h-80">
                    <canvas id="maintenanceCycleChart"></canvas>
                </div>
            </div>
        </section>

        <section class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
            <div class="bg-primary rounded-xl p-6 shadow-lg border border-neon/20">
                <h3 class="text-xl font-semibold mb-6 text-white">设备维护历史</h3>
                <div class="h-80">
                    <canvas id="maintenanceHistoryChart"></canvas>
                </div>
            </div>
            <div class="bg-primary rounded-xl p-6 shadow-lg border border-neon/20">
                <h3 class="text-xl font-semibold mb-6 text-white">设备类型分布</h3>
                <div class="h-80">
                    <canvas id="equipmentTypeChart"></canvas>
                </div>
            </div>
        </section>

        <!-- 设备列表 -->
        <section class="bg-primary rounded-xl p-6 shadow-lg border border-neon/20 mb-12">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-white">设备详情</h3>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-700">
                    <thead>
                    <tr>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider align-middle">设备名称</th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider align-middle">型号</th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider align-middle">工作寿命(月)</th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider align-middle">维护周期(月)</th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider align-middle">已使用时间(月)</th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider align-middle">剩余寿命(月)</th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider align-middle">下次维护日期</th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider align-middle">状态</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-700" id="equipment-details">
                    <!-- 数据将通过JavaScript动态加载 -->
                    <tr class="animate-pulse">
                        <td colspan="8" class="px-4 py-8 text-center text-gray-500 align-middle">加载中...</td>
                    </tr>
                </tbody>
                </table>
            </div>
        </section>
    </main>

    <footer class="bg-primary py-8 mt-12 border-t border-neon/30">
        <div class="container mx-auto px-4 text-center">
            <p>自控设备全生命周期管理平台 &copy; 2025</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 从服务器获取生命周期分析数据
            fetch('/monitoring/data/')
                .then(response => response.json())
                .then(data => {
                    // 初始化图表
                    initCharts(data);
                    // 填充设备详情表
                    populateEquipmentDetails(data.equipment_details);
                })
                .catch(error => {
                    console.error('获取数据失败:', error);
                    // 显示错误信息
                    document.getElementById('equipment-details').innerHTML = 
                        '<tr><td colspan="8" class="px-4 py-8 text-center text-red-500">加载数据失败</td></tr>';
                });

            function initCharts(data) {
                // 设备寿命状态图表
                const lifespanCtx = document.getElementById('equipmentLifespanChart').getContext('2d');
                const lifespanChart = new Chart(lifespanCtx, {
                    type: 'bar',
                    data: {
                        labels: data.equipment_details.map(item => item.name),
                        datasets: [{
                            label: '已使用时间(月)',
                            data: data.equipment_details.map(item => item.used_months),
                            backgroundColor: '#3b82f6',
                            borderColor: '#1e40af',
                            borderWidth: 1
                        }, {
                            label: '总工作寿命(月)',
                            data: data.equipment_details.map(item => item.working_life),
                            backgroundColor: '#10b981',
                            borderColor: '#047857',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: '#e2e8f0',
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: '#e2e8f0'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            },
                            x: {
                                ticks: {
                                    color: '#e2e8f0',
                                    font: {
                                        size: 10
                                    }
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            }
                        }
                    }
                });

                // 维护周期分析图表
                const cycleCtx = document.getElementById('maintenanceCycleChart').getContext('2d');
                const cycleChart = new Chart(cycleCtx, {
                    type: 'bar',
                    data: {
                        labels: data.equipment_details.map(item => item.name),
                        datasets: [{
                            label: '实际维护周期(月)',
                            data: data.equipment_details.map(item => item.actual_cycle),
                            backgroundColor: '#f59e0b',
                            borderColor: '#92400e',
                            borderWidth: 1
                        }, {
                            label: '标准维护周期(月)',
                            data: data.equipment_details.map(item => item.maintenance_cycle),
                            backgroundColor: '#8b5cf6',
                            borderColor: '#5b21b6',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: '#e2e8f0',
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: '#e2e8f0'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            },
                            x: {
                                ticks: {
                                    color: '#e2e8f0',
                                    font: {
                                        size: 10
                                    }
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            }
                        }
                    }
                });

                // 设备维护历史图表
                const historyCtx = document.getElementById('maintenanceHistoryChart').getContext('2d');
                const historyChart = new Chart(historyCtx, {
                    type: 'line',
                    data: {
                        labels: data.maintenance_history.map(item => item.month),
                        datasets: [{
                            label: '维护次数',
                            data: data.maintenance_history.map(item => item.count),
                            backgroundColor: '#ef4444',
                            borderColor: '#ef4444',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: '#e2e8f0'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            },
                            x: {
                                ticks: {
                                    color: '#e2e8f0',
                                    font: {
                                        size: 12
                                    }
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            }
                        }
                    }
                });

                // 设备类型分布图表
                const typeCtx = document.getElementById('equipmentTypeChart').getContext('2d');
                const typeChart = new Chart(typeCtx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(data.equipment_type_distribution),
                        datasets: [{
                            data: Object.values(data.equipment_type_distribution),
                            backgroundColor: [
                                '#10b981', // 绿色
                                '#f59e0b', // 黄色
                                '#ef4444', // 红色
                                '#6b7280', // 灰色
                                '#3b82f6', // 蓝色
                                '#8b5cf6', // 紫色
                                '#ec4899', // 粉色
                                '#06b6d4'  // 青色
                            ],
                            borderColor: '#0f172a',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    color: '#e2e8f0',
                                }
                            }
                        }
                    }
                });
            }

            function populateEquipmentDetails(equipmentDetails) {
                const container = document.getElementById('equipment-details');
                container.innerHTML = '';

                equipmentDetails.forEach(item => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-800/50 transition-colors duration-300';
                    
                    // 确定状态标签的样式
                    let statusClass = 'bg-gray-100 text-gray-800';
                    if (item.status === '运行中') {
                        statusClass = 'bg-green-900/50 text-green-400 border border-green-500/30';
                    } else if (item.status === '维护中') {
                        statusClass = 'bg-yellow-900/50 text-yellow-400 border border-yellow-500/30';
                    } else if (item.status === '故障') {
                        statusClass = 'bg-red-900/50 text-red-400 border border-red-500/30';
                    } else if (item.status === '停用') {
                        statusClass = 'bg-gray-800/50 text-gray-400 border border-gray-600/30';
                    }
                    
                    row.innerHTML = `
                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-300 text-center align-middle">${item.name}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-400 text-center align-middle">${item.model}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-400 text-center align-middle">${item.working_life || '0'}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-400 text-center align-middle">${item.maintenance_cycle}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-400 text-center align-middle">${item.used_months.toFixed(1)}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-400 text-center align-middle">${item.remaining_life.toFixed(1)}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-400 text-center align-middle">${item.next_maintenance || '无'}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-center align-middle">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">${item.status}</span>
                            </td>
                        `;
                    container.appendChild(row);
                });
            }
        });
    </script>
</body>
</html>